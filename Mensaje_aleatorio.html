<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interacción por Movimiento</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            background: black;
            color: white;
            text-align: center;
        }

        video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }

        h1 {
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        #enable-sensors {
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 20px;
        }

        #enable-sensors:active {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <video autoplay muted loop playsinline>
        <source src="https://timoibarra.github.io/spaces%20background.mp4" type="video/mp4">
        Tu navegador no soporta videos.
    </video>
    <button id="enable-sensors">Habilitar Sensores</button>
    <h1 id="header">Agita tu celular para descubrir un mensaje...</h1>

    <script>
        const header = document.getElementById('header');
        const enableSensorsButton = document.getElementById('enable-sensors');
        const messages = [
            "Mensaje de prueba 1",
            "Mensaje de prueba 2",
            "Mensaje de prueba 3",
            "Mensaje de prueba 4",
            "Mensaje de prueba 5"
        ];
        let lastMessageIndex = -1;

        function showMessage(message) {
            header.style.opacity = '0';
            setTimeout(() => {
                header.textContent = message;
                header.style.opacity = '1';
            }, 500);
        }

        function requestSensorAccess() {
            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(permissionState => {
                    if (permissionState === 'granted') {
                        enableShakeDetection();
                    } else {
                        alert("No se otorgó permiso para los sensores de movimiento.");
                    }
                }).catch(console.error);
            } else {
                enableShakeDetection();
            }
        }

        function enableShakeDetection() {
            let lastAcceleration = null;
            const threshold = 15; // Ajustar según sea necesario

            window.addEventListener('devicemotion', (event) => {
                const { x, y, z } = event.accelerationIncludingGravity;

                if (lastAcceleration) {
                    const deltaX = x - lastAcceleration.x;
                    const deltaY = y - lastAcceleration.y;
                    const deltaZ = z - lastAcceleration.z;

                    const magnitude = Math.sqrt(deltaX * deltaX + deltaY * deltaY + deltaZ * deltaZ);

                    if (magnitude > threshold) {
                        let newIndex;
                        do {
                            newIndex = Math.floor(Math.random() * messages.length);
                        } while (newIndex === lastMessageIndex);

                        lastMessageIndex = newIndex;
                        showMessage(messages[newIndex]);
                    }
                }

                lastAcceleration = { x, y, z };
            });

            enableSensorsButton.style.display = 'none';
            showMessage("¡Sensores habilitados! Agita tu celular para descubrir un mensaje...");
        }

        enableSensorsButton.addEventListener('click', requestSensorAccess);
    </script>
</body>
</html>
